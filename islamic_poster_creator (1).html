<!DOCTYPE html>

<html dir="rtl" lang="ur">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Islamic Poster Creator - Inline Editing</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Nastaliq+Urdu:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Nastaliq Urdu', 'Amiri', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .toolbar {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Noto Nastaliq Urdu', 'Amiri', serif;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .poster-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
        }

        .poster-preview {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            flex: 1;
            max-width: 800px;
        }

        #posterCanvas {
            width: 100%;
            background: linear-gradient(to bottom, #87CEEB 0%, #f5f5dc 50%, #90EE90 100%);
            border: 3px solid #c41e3a;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.2);
        }

        .editable {
            cursor: text;
            transition: all 0.3s;
            position: relative;
            min-height: 20px;
        }

        .editable:hover {
            outline: 2px dashed #667eea;
            outline-offset: 3px;
            background: rgba(102, 126, 234, 0.1);
        }

        .editable:focus {
            outline: 3px solid #667eea;
            outline-offset: 3px;
            background: rgba(102, 126, 234, 0.15);
        }

        .editable[contenteditable="true"]:empty:before {
            content: attr(data-placeholder);
            color: rgba(255,255,255,0.5);
            font-style: italic;
        }

        .deletable {
            position: relative;
        }

        .delete-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .deletable:hover .delete-btn {
            display: flex;
        }

        .poster-header {
            background: linear-gradient(90deg, #FFA500 0%, #FFD700 50%, #FFA500 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .poster-title {
            background: #c41e3a;
            color: white;
            font-size: 48px;
            font-weight: bold;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .poster-dates {
            background: #4169E1;
            color: white;
            font-size: 32px;
            padding: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .date-badge {
            background: white;
            color: #4169E1;
            padding: 5px 15px;
            border-radius: 50%;
            font-weight: bold;
        }

        .sections-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .section-card {
            background: #FFA500;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .section-title {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
        }

        .section-content {
            background: #4169E1;
            color: white;
            padding: 15px;
            border-radius: 10px;
            border: 3px dotted white;
            min-height: 120px;
            font-size: 16px;
            line-height: 1.8;
        }

        .timing-section {
            background: #2C5F4F;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .bottom-sections {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .bottom-card {
            background: #FFA500;
            border-radius: 10px;
            padding: 15px;
            border: 3px solid #8B4513;
        }

        .bottom-card-title {
            background: #8B4513;
            color: #FFD700;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .bottom-card-content {
            color: #000;
            font-size: 14px;
            line-height: 1.8;
        }

        .middle-section {
            background: #2C5F4F;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .middle-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .middle-content {
            font-size: 14px;
            line-height: 1.6;
        }

        .footer-section {
            background: linear-gradient(90deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-phone {
            font-size: 18px;
            font-weight: bold;
        }

        .footer-address {
            font-size: 20px;
            font-weight: bold;
        }

        .decorative-elements {
            position: absolute;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #FFA500 0%, #FFD700 100%);
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        }

        .deco-left {
            top: 20px;
            left: -10px;
        }

        .deco-right {
            top: 20px;
            right: -10px;
        }

        .sidebar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 300px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .sidebar h3 {
            text-align: center;
            color: #c41e3a;
            margin-bottom: 15px;
        }

        .poster-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .poster-item {
            background: #f8f9fa;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .poster-item:hover {
            background: #e9ecef;
            transform: translateX(-5px);
        }

        .poster-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .poster-item-date {
            font-size: 12px;
            color: #666;
        }

        .poster-item-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }

        .add-section-btn {
            background: #28a745;
            color: white;
            border: 2px dashed white;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
        }

        .add-section-btn:hover {
            background: #218838;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .color-picker-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: #667eea;
        }

        @media (max-width: 1200px) {
            .poster-container {
                flex-direction: column;
                align-items: center;
            }

            .sidebar {
                width: 100%;
                max-width: 800px;
            }
        }
    </style>
<link href="manifest.json" rel="manifest"/><link href="favicon.ico" rel="icon" type="image/x-icon"/></head>
<body>
<div class="toolbar">
<input id="posterNameInput" placeholder="Ù¾ÙˆØ³Ù¹Ø± Ú©Ø§ Ù†Ø§Ù…" style="padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-family: 'Noto Nastaliq Urdu', serif; width: 200px;" type="text"/>
<button class="btn btn-success" onclick="savePoster()">ğŸ’¾ Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
<button class="btn btn-primary" onclick="newPoster()">ğŸ“„ Ù†ÛŒØ§ Ù¾ÙˆØ³Ù¹Ø±</button>
<button class="btn btn-info" onclick="exportToImage()">ğŸ“· ØªØµÙˆÛŒØ± (High Res)</button>
<button class="btn btn-warning" onclick="exportToPDF()">ğŸ“„ PDF</button>
<button class="btn btn-secondary" onclick="toggleSidebar()">ğŸ“‹ Ù…Ø­ÙÙˆØ¸ Ø´Ø¯Û</button>
</div>
<div class="poster-container">
<div class="poster-preview">
<div id="posterCanvas">
<div class="poster-header deletable">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
<div class="decorative-elements deco-left"></div>
<div class="decorative-elements deco-right"></div>
<div class="poster-title editable" contenteditable="true" data-placeholder="Ø¹Ù†ÙˆØ§Ù† Ù„Ú©Ú¾ÛŒÚº">Ø§Ø¹Ù„Ø§Ù† Ø¯Ø§Ø®Ù„Û</div>
<div class="poster-dates">
<span class="editable" contenteditable="true">1445</span>
<span>/</span>
<span class="editable" contenteditable="true">2024</span>
</div>
<div style="display: flex; justify-content: space-around; margin-top: 10px; font-size: 18px;">
<span><span class="date-badge editable" contenteditable="true">10</span> <span class="editable" contenteditable="true">Ø´ÙˆØ§Ù„ 1445</span></span>
<span><span class="date-badge editable" contenteditable="true">20</span> <span class="editable" contenteditable="true">Ø§Ù¾Ø±ÛŒÙ„ 2024</span></span>
</div>
</div>
<div class="sections-container" id="mainSections">
<div class="section-card deletable">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
<div class="section-title editable" contenteditable="true" data-placeholder="Ø¹Ù†ÙˆØ§Ù†">ØªØµÙˆØ±ÛŒ Ø¹Ù„Ù…ÛŒÙ…</div>
<div class="section-content editable" contenteditable="true" data-placeholder="ØªÙØµÛŒÙ„ Ù„Ú©Ú¾ÛŒÚº">Ø§Ù†Ø¯Ø±ÙˆÙ†ÛŒ Ù…Ø°ÛØ¨ÛŒ ØªØ¹Ù„ÛŒÙ… Ú©ÛŒ ÙØ±Ø§ÛÙ…ÛŒ Ú©Û’ Ø³Ø§ØªÚ¾ Ù…Ø¹Ø§Ø´Ø±Û’ Ú©Û’ Ù„ÛŒÛ’ Ù…ÙÛŒØ¯ Ø§Ù†Ø³Ø§Ù† ØªÛŒØ§Ø± Ú©Ø±ÛŒÚº</div>
</div>
<div class="section-card deletable" style="background: #2C5F4F;">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
<div class="section-title editable" contenteditable="true" style="background: rgba(255,255,255,0.2);">ØªØ¬ÙˆÛŒØ¯Ø§Ù„Ù‚Ø±Ø¢Ù†</div>
<div class="section-content editable" contenteditable="true" style="background: #E6B0AA; color: #000; border-color: #8B4513;">Ø­Ø§ÙØ¸Û Ù‚Ø±Ø¢Ù† Ú©Ø±ÛŒÙ… Ø§ÙˆØ± ØªØ¬ÙˆÛŒØ¯ Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…</div>
</div>
<div class="section-card deletable">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
<div class="section-title editable" contenteditable="true">Ø¯Ø±ÙˆØ³ Ù†Ø¸Ø§Ù…ÛŒ</div>
<div class="section-content editable" contenteditable="true">Ø§ÙˆÙ„Ø§Ø¯ Ú©ÛŒ ØªØ¹Ù„ÛŒÙ… Ùˆ ØªØ±Ø¨ÛŒØª Ú©ÛŒ ÙÚ©Ø± ÛÛ’ ØªÙˆ Ø§Ø¨Ú¾ÛŒ Ø¯Ø§Ø®Ù„Û Ù„ÛŒÚº</div>
</div>
</div>
<div class="add-section-btn" onclick="addMainSection()">+ Ù†ÛŒØ§ Ø³ÛŒÚ©Ø´Ù† Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</div>
<div class="timing-section editable deletable" contenteditable="true" data-placeholder="Ø§ÙˆÙ‚Ø§Øª Ù„Ú©Ú¾ÛŒÚº">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
                    Ø§ÙˆÙ‚Ø§Øª Ø¯Ø§Ø®Ù„Û: ØµØ¨Ø­ 8:00 ØªØ§ 12:30
                </div>
<div class="deletable" style="background: #2C5F4F; padding: 15px; border-radius: 10px; margin-bottom: 15px; color: white; text-align: center;">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
<div class="editable" contenteditable="true" style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Ø´Ø¹Ø¨Û Ø­ÙØ¸ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</div>
<div class="editable" contenteditable="true" data-placeholder="ØªÙØµÛŒÙ„ Ù„Ú©Ú¾ÛŒÚº" style="font-size: 14px; line-height: 1.6;">10 Ø´ÙˆØ§Ù„ Ø³Û’ Ù…Ø³Ù„Ø³Ù„ 20 Ø§Ù¾Ø±ÛŒÙ„ ØªÚ© Ø§ÙˆØ± Ø±ÙˆØ³ Ø§ØªÙØ§Ù‚ÛŒ Ú©Û’ Ø·Ù„Ø¨Ø§Ø¡ Ú©Û’ Ù„ÛŒÛ’ 13 Ø´ÙˆØ§Ù„ 23 Ø§Ù¾Ø±ÛŒÙ„ Ø³Û’ Ù…Ø³Ù„Ø³Ù„ Ø´Ø±ÙˆØ¹</div>
</div>
<div class="bottom-sections" id="bottomSections">
<div class="bottom-card deletable">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
<div class="bottom-card-title editable" contenteditable="true">Ø¶Ø±ÙˆØ±ÛŒ Ù†ÙˆÙ¹</div>
<div class="bottom-card-content editable" contenteditable="true" data-placeholder="Ù†ÙˆÙ¹ Ù„Ú©Ú¾ÛŒÚº">Ø­Ø§ÙØ¸Û ÛÙˆ Ø¬Ø§Ù†Û’ ÙˆØ§Ù„Ø§ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù…ØŒ Ø§Ø±Ø§Ø¯Û’ Ú©Û’ Ø³Ø§ØªÚ¾ Ø¯Ø§Ø±Ø§Ù„Ø¹Ù„ÙˆÙ… Ù…ÛŒÚº Ø¯Ø§Ø®Ù„Û Ù„Û’ Ø§ÙˆØ± Ú©ÛŒ ÙØ¶ÛŒÙ„Øª</div>
</div>
<div class="middle-section deletable">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
<div class="middle-title editable" contenteditable="true">Ø¯ÛŒÙ†ÛŒ Ø§ÙˆØ± Ø¹ØµØ±ÛŒ Ø¹Ù„ÙˆÙ… Ú©Ø§ Ø­Ø³ÛŒÙ† Ø§Ù…ØªØ²Ø§Ø¬</div>
<div class="middle-content editable" contenteditable="true" data-placeholder="ØªÙØµÛŒÙ„">Ø¯ÛŒÙ†ÛŒ ØªØ¹Ù„ÛŒÙ…Ø§Øª Ú©Û’ Ø³Ø§ØªÚ¾ Ø¹ØµØ±ÛŒ Ø¹Ù„ÙˆÙ… Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…Û” Ù‚Ø±Ø¢Ù†ØŒ Ø­Ø¯ÛŒØ«ØŒ ÙÙ‚Û Ø§ÙˆØ± Ø¹Ø±Ø¨ÛŒ Ø²Ø¨Ø§Ù† Ú©Û’ Ø³Ø§ØªÚ¾ Ø§Ù†Ú¯Ù„Ø´ØŒ Ø§Ø±Ø¯ÙˆØŒ Ø±ÛŒØ§Ø¶ÛŒ Ø§ÙˆØ± Ø³Ø§Ø¦Ù†Ø³</div>
</div>
<div class="bottom-card deletable">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
<div class="bottom-card-title editable" contenteditable="true">Ø®Ø§Øµ Ù†ÙˆÙ¹</div>
<div class="bottom-card-content editable" contenteditable="true" data-placeholder="Ù†ÙˆÙ¹ Ù„Ú©Ú¾ÛŒÚº">Ø§ÙˆÙ„Ø§Ø¯ Ú©ÛŒ ØªØ¹Ù„ÛŒÙ… Ùˆ ØªØ±Ø¨ÛŒØª Ú©ÛŒ ÙÚ©Ø± ÛÛ’ ØªÙˆ ÛÙ…Ø§Ø±Û’ Ø³Ø§ØªÚ¾ Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚº Ø§ÙˆØ± Ø§Ù¾Ù†Û’ Ø¨Ú†ÙˆÚº Ú©Ùˆ Ø¯ÛŒÙ†ÛŒ Ø§ÙˆØ± Ø¹ØµØ±ÛŒ ØªØ¹Ù„ÛŒÙ… Ø³Û’ Ø¢Ø±Ø§Ø³ØªÛ Ú©Ø±ÛŒÚº</div>
</div>
</div>
<div class="add-section-btn" onclick="addBottomSection()">+ Ù†Ú†Ù„Ø§ Ø³ÛŒÚ©Ø´Ù† Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</div>
<div class="footer-section deletable">
<button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
<div class="footer-phone editable" contenteditable="true" data-placeholder="ÙÙˆÙ† Ù†Ù…Ø¨Ø±">ğŸ“ 0336-9586656 | 0311-5342747 | 0312-3550107</div>
<div class="footer-address">
<div class="editable" contenteditable="true" data-placeholder="Ù¾ØªÛ">Ù…Ø¯Ø±Ø³Û Ø¹Ø±Ø¨ÛŒÛ Ø§Ø³Ù„Ø§Ù…ÛŒÛ Ù…ÛŒÙ…Ù„</div>
<div class="editable" contenteditable="true" data-placeholder="Ù…Ú©Ù…Ù„ Ù¾ØªÛ" style="font-size: 14px; margin-top: 5px;">Ø´Ø§ÛØ±Ø§Û Ø­ØµÛ Ù¾Ù„ ÛØ±Ù† Ù…Ø³Ø¬Ø¯ Ø´Ø±ÛŒÙ Ú©Ø±Ø§Ú†ÛŒ</div>
</div>
<div style="width: 60px; height: 60px; background: linear-gradient(135deg, #FFA500, #FFD700); clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);"></div>
</div>
</div>
</div>
<div class="sidebar" id="sidebar" style="display: none;">
<h3>ğŸ“‹ Ù…Ø­ÙÙˆØ¸ Ø´Ø¯Û Ù¾ÙˆØ³Ù¹Ø±Ø²</h3>
<div class="poster-list" id="posterList"></div>
</div>
</div>
<script>
        // IndexedDB Setup
        let db;
        const DB_NAME = 'IslamicPosterDB';
        const STORE_NAME = 'posters';

        function initDB() {
            const request = indexedDB.open(DB_NAME, 1);

            request.onerror = () => {
                console.error('Database failed to open');
            };

            request.onsuccess = () => {
                db = request.result;
                loadPosterList();
            };

            request.onupgradeneeded = (e) => {
                db = e.target.result;
                const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                objectStore.createIndex('name', 'name', { unique: false });
                objectStore.createIndex('timestamp', 'timestamp', { unique: false });
            };
        }

        function savePoster() {
            const posterName = document.getElementById('posterNameInput').value || 'Ø¨Û’ Ù†Ø§Ù… Ù¾ÙˆØ³Ù¹Ø± ' + new Date().toLocaleString('ur-PK');
            const posterHTML = document.getElementById('posterCanvas').innerHTML;

            const posterData = {
                name: posterName,
                timestamp: new Date().toISOString(),
                html: posterHTML
            };

            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const objectStore = transaction.objectStore(STORE_NAME);
            const request = objectStore.add(posterData);

            request.onsuccess = () => {
                showToast('âœ… Ù¾ÙˆØ³Ù¹Ø± Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ú¯ÛŒØ§!');
                loadPosterList();
                document.getElementById('posterNameInput').value = '';
            };

            request.onerror = () => {
                showToast('âŒ Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ!', 'error');
            };
        }

        function loadPosterList() {
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const objectStore = transaction.objectStore(STORE_NAME);
            const request = objectStore.getAll();

            request.onsuccess = () => {
                const posters = request.result;
                const listContainer = document.getElementById('posterList');
                listContainer.innerHTML = '';

                if (posters.length === 0) {
                    listContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Ú©ÙˆØ¦ÛŒ Ù…Ø­ÙÙˆØ¸ Ø´Ø¯Û Ù¾ÙˆØ³Ù¹Ø± Ù†ÛÛŒÚº</p>';
                    return;
                }

                posters.reverse().forEach(poster => {
                    const item = document.createElement('div');
                    item.className = 'poster-item';

                    const date = new Date(poster.timestamp).toLocaleString('ur-PK');

                    item.innerHTML = `
                        <div class="poster-item-name">${poster.name}</div>
                        <div class="poster-item-date">${date}</div>
                        <div class="poster-item-actions">
                            <button class="btn btn-primary btn-small" onclick="loadPoster(${poster.id})">Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</button>
                            <button class="btn btn-danger btn-small" onclick="deletePoster(${poster.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                        </div>
                    `;
                    listContainer.appendChild(item);
                });
            };
        }

        function loadPoster(id) {
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const objectStore = transaction.objectStore(STORE_NAME);
            const request = objectStore.get(id);

            request.onsuccess = () => {
                const poster = request.result;
                if (poster) {
                    document.getElementById('posterCanvas').innerHTML = poster.html;
                    document.getElementById('posterNameInput').value = poster.name;
                    showToast('âœ… Ù¾ÙˆØ³Ù¹Ø± Ù„ÙˆÚˆ ÛÙˆ Ú¯ÛŒØ§!');
                }
            };
        }

        function deletePoster(id) {
            if (!confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ù¾ÙˆØ³Ù¹Ø± Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) return;

            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const objectStore = transaction.objectStore(STORE_NAME);
            const request = objectStore.delete(id);

            request.onsuccess = () => {
                showToast('âœ… Ù¾ÙˆØ³Ù¹Ø± Ø­Ø°Ù ÛÙˆ Ú¯ÛŒØ§!');
                loadPosterList();
            };
        }

        function newPoster() {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ Ù†ÛŒØ§ Ù¾ÙˆØ³Ù¹Ø± Ø¨Ù†Ø§Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ Ù…ÙˆØ¬ÙˆØ¯Û ØªØ¨Ø¯ÛŒÙ„ÛŒØ§Úº Ø¶Ø§Ø¦Ø¹ ÛÙˆ Ø¬Ø§Ø¦ÛŒÚº Ú¯ÛŒÛ”')) {
                location.reload();
            }
        }

        function deleteElement(btn) {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ Ø§Ø³ Ø¹Ù†ØµØ± Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                const element = btn.parentElement;
                element.remove();
                showToast('âœ… Ø¹Ù†ØµØ± Ø­Ø°Ù ÛÙˆ Ú¯ÛŒØ§');
            }
        }

        function addMainSection() {
            const container = document.getElementById('mainSections');
            const newSection = document.createElement('div');
            newSection.className = 'section-card deletable';
            newSection.innerHTML = `
                <button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
                <div class="section-title editable" contenteditable="true" data-placeholder="Ø¹Ù†ÙˆØ§Ù† Ù„Ú©Ú¾ÛŒÚº">Ù†ÛŒØ§ Ø³ÛŒÚ©Ø´Ù†</div>
                <div class="section-content editable" contenteditable="true" data-placeholder="ØªÙØµÛŒÙ„ Ù„Ú©Ú¾ÛŒÚº">ÛŒÛØ§Úº Ø§Ù¾Ù†ÛŒ ØªÙØµÛŒÙ„ Ù„Ú©Ú¾ÛŒÚº</div>
            `;
            container.appendChild(newSection);
            showToast('âœ… Ù†ÛŒØ§ Ø³ÛŒÚ©Ø´Ù† Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§');
        }

        function addBottomSection() {
            const container = document.getElementById('bottomSections');
            const newSection = document.createElement('div');
            newSection.className = 'bottom-card deletable';
            newSection.innerHTML = `
                <button class="delete-btn" onclick="deleteElement(this)">Ã—</button>
                <div class="bottom-card-title editable" contenteditable="true" data-placeholder="Ø¹Ù†ÙˆØ§Ù†">Ù†ÛŒØ§ Ø³ÛŒÚ©Ø´Ù†</div>
                <div class="bottom-card-content editable" contenteditable="true" data-placeholder="Ù…ÙˆØ§Ø¯ Ù„Ú©Ú¾ÛŒÚº">ÛŒÛØ§Úº Ø§Ù¾Ù†Ø§ Ù…ÙˆØ§Ø¯ Ù„Ú©Ú¾ÛŒÚº</div>
            `;
            container.appendChild(newSection);
            showToast('âœ… Ù†ÛŒØ§ Ø³ÛŒÚ©Ø´Ù† Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.style.display = sidebar.style.display === 'none' ? 'block' : 'none';
        }

        async function exportToImage() {
            const canvas = document.getElementById('posterCanvas');

            // Hide delete buttons before export
            const deleteButtons = canvas.querySelectorAll('.delete-btn');
            deleteButtons.forEach(btn => btn.style.display = 'none');

            try {
                const downloadCanvas = await html2canvas(canvas, {
                    scale: 3,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: canvas.offsetWidth,
                    height: canvas.offsetHeight
                });

                const link = document.createElement('a');
                link.download = `islamic-poster-${Date.now()}.png`;
                link.href = downloadCanvas.toDataURL('image/png', 1.0);
                link.click();

                showToast('âœ… ØªØµÙˆÛŒØ± Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ ÛÙˆ Ú¯Ø¦ÛŒ!');
            } catch (error) {
                console.error('Export error:', error);
                showToast('âŒ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ!', 'error');
            }

            // Show delete buttons again
            deleteButtons.forEach(btn => btn.style.display = '');
        }

        async function exportToPDF() {
            const canvas = document.getElementById('posterCanvas');

            // Hide delete buttons before export
            const deleteButtons = canvas.querySelectorAll('.delete-btn');
            deleteButtons.forEach(btn => btn.style.display = 'none');

            try {
                const downloadCanvas = await html2canvas(canvas, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff'
                });

                const imgData = downloadCanvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                const imgWidth = 210;
                const imgHeight = (downloadCanvas.height * imgWidth) / downloadCanvas.width;

                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                pdf.save(`islamic-poster-${Date.now()}.pdf`);

                showToast('âœ… PDF Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ ÛÙˆ Ú¯Ø¦ÛŒ!');
            } catch (error) {
                console.error('PDF export error:', error);
                showToast('âŒ PDF Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ!', 'error');
            }

            // Show delete buttons again
            deleteButtons.forEach(btn => btn.style.display = '');
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            toast.style.background = type === 'success' ? '#28a745' : '#dc3545';
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize
        window.onload = () => {
            initDB();
        };

        // Auto-save functionality (optional)
        let autoSaveTimer;
        document.getElementById('posterCanvas').addEventListener('input', () => {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                // Optional: Implement auto-save here
            }, 5000);
        });
    </script>
<script type="module">
  import { Workbox } from 'https://storage.googleapis.com/workbox-cdn/releases/7.0.0/workbox-window.prod.mjs';

  const swUrl = './sw.js';
  const wb = new Workbox(swUrl);

  wb.addEventListener('waiting', () => {
    console.log('A new service worker is waiting to activate.');
    wb.messageSW({ type: 'SKIP_WAITING' });
  });

  wb.addEventListener('controlling', () => {
    console.log('The new service worker is now in control. Reloading page for updates...');
    window.location.reload();
  });

  wb.register();
</script></body>
</html>
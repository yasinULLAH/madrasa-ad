<!DOCTYPE html>

<html dir="rtl" lang="ur">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ma'had Rasheed Poster Creator</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&amp;family=Roboto:wght@300;400;700&amp;display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.1/qrcode.min.js"></script>
<style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Nastaliq Urdu', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #2d5f3f;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #2d5f3f, #1a3a28);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .poster-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .poster-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .poster-card:hover {
            transform: translateY(-5px);
        }

        .poster-preview {
            width: 100%;
            height: auto;
            cursor: pointer;
        }

        .poster-actions {
            padding: 15px;
            display: flex;
            gap: 10px;
            justify-content: space-around;
            background: #f9fafb;
        }

        .poster-actions button {
            flex: 1;
            padding: 8px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 30px;
            cursor: pointer;
            color: #6b7280;
            background: none;
            border: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Noto Nastaliq Urdu', sans-serif;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .poster-template {
            width: 595px;
            height: 842px;
            background: white;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .poster-header {
            background: linear-gradient(135deg, rgba(45, 95, 63, 0.1), rgba(255, 255, 255, 0.9));
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #2d5f3f;
            position: relative;
        }

        .poster-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 100%;
            background: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
            clip-path: polygon(30% 0, 100% 0, 100% 100%, 0% 100%);
            z-index: 0;
        }

        .header-logos {
            display: flex;
            gap: 15px;
            align-items: center;
            z-index: 1;
        }

        .logo-placeholder {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #2d5f3f, #1a3a28);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .header-title {
            flex: 1;
            text-align: center;
            z-index: 1;
        }

        .header-title h1 {
            font-size: 32px;
            color: #2d5f3f;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-title h2 {
            font-size: 28px;
            color: #f97316;
        }

        .poster-body {
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .announcement-box {
            background: linear-gradient(135deg, #2d5f3f, #1a3a28);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(45, 95, 63, 0.3);
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .features-section {
            background: #f0fdf4;
            padding: 20px;
            border-radius: 12px;
            border: 3px solid #2d5f3f;
        }

        .features-section h3 {
            color: white;
            background: #2d5f3f;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .feature-item {
            padding: 8px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .feature-item::before {
            content: 'â˜…';
            color: #f97316;
            font-size: 18px;
        }

        .conditions-section {
            background: #fff7ed;
            padding: 20px;
            border-radius: 12px;
            border: 3px solid #f97316;
        }

        .conditions-section h3 {
            color: white;
            background: #f97316;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .images-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .hex-image {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #2d5f3f, #10b981);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .qr-contact-section {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f0fdf4, #fff7ed);
            border-radius: 12px;
        }

        .qr-code {
            width: 120px;
            height: 120px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .contact-info {
            text-align: right;
        }

        .contact-item {
            margin: 8px 0;
            font-size: 14px;
            color: #1f2937;
            font-weight: 600;
        }

        .footer-banner {
            background: linear-gradient(135deg, #2d5f3f, #10b981);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
            border-radius: 8px;
        }

        .date-badges {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .date-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .poster-grid {
                grid-template-columns: 1fr;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .poster-template {
                transform: scale(0.5);
                transform-origin: top center;
            }

            .modal-content {
                padding: 15px;
            }

            .controls {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 2000;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e5e7eb;
            border-top-color: #2d5f3f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .preview-container {
            max-width: 100%;
            overflow: auto;
            background: #f3f4f6;
            padding: 20px;
            border-radius: 12px;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
<link href="manifest.json" rel="manifest"/><link href="favicon.ico" rel="icon" type="image/x-icon"/></head>
<body>
<div class="container">
<div class="header">
<h1>Ù…Ø¹ÛØ¯ Ø§Ù„Ø±Ø´ÛŒØ¯ - Ù¾ÙˆØ³Ù¹Ø± ØªØ®Ù„ÛŒÙ‚ Ú©Ø§Ø±</h1>
<p>Ma'had Rasheed Poster Creator &amp; Manager</p>
</div>
<div class="controls">
<button class="btn btn-primary" onclick="openCreateModal()">â• Ù†ÛŒØ§ Ù¾ÙˆØ³Ù¹Ø± Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
<button class="btn btn-success" onclick="exportAllData()">ğŸ’¾ ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
<button class="btn btn-warning" onclick="document.getElementById('importFile').click()">ğŸ“‚ ÚˆÛŒÙ¹Ø§ Ø¯Ø±Ø¢Ù…Ø¯
                Ú©Ø±ÛŒÚº</button>
<button class="btn btn-danger" onclick="deleteAllPosters()">ğŸ—‘ï¸ ØªÙ…Ø§Ù… Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
</div>
<input accept=".json" id="importFile" onchange="importData(event)" style="display:none" type="file"/>
<div class="poster-grid" id="posterGrid"></div>
</div>
<div class="modal" id="editorModal">
<div class="modal-content">
<button class="modal-close" onclick="closeModal()">Ã—</button>
<h2 style="margin-bottom: 25px; color: #2d5f3f; text-align: center;">Ù¾ÙˆØ³Ù¹Ø± Ø§ÛŒÚˆÛŒÙ¹Ø±</h2>
<form id="posterForm" onsubmit="savePoster(event)">
<input id="posterId" type="hidden"/>
<div class="form-row">
<div class="form-group">
<label>Ø§Ø¯Ø§Ø±Û’ Ú©Ø§ Ù†Ø§Ù… (Urdu)</label>
<input id="institutionNameUrdu" required="" type="text"/>
</div>
<div class="form-group">
<label>Ø§Ø¯Ø§Ø±Û’ Ú©Ø§ Ù†Ø§Ù… (English)</label>
<input id="institutionNameEng" required="" type="text"/>
</div>
</div>
<div class="form-group">
<label>Ø§Ø¹Ù„Ø§Ù† (Announcement)</label>
<input id="announcement" required="" type="text"/>
</div>
<div class="form-row">
<div class="form-group">
<label>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ (Start Date)</label>
<input id="startDate" required="" type="text"/>
</div>
<div class="form-group">
<label>ØªØ§Ø±ÛŒØ® Ø®ØªÙ… (End Date)</label>
<input id="endDate" required="" type="text"/>
</div>
</div>
<div class="form-group">
<label>Ø®ØµÙˆØµÛŒØ§Øª (Features - Ø¹Ù„Ø§Ù…Øª Ø³Û’ Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº)</label>
<textarea id="features" required=""></textarea>
</div>
<div class="form-group">
<label>Ø´Ø±Ø§Ø¦Ø· (Conditions - Ø¹Ù„Ø§Ù…Øª Ø³Û’ Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº)</label>
<textarea id="conditions" required=""></textarea>
</div>
<div class="form-group">
<label>Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±Ø² (Contact Numbers - Ú©ÙˆÙ…Ø§ Ø³Û’ Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº)</label>
<input id="contactNumbers" required="" type="text"/>
</div>
<div class="form-group">
<label>ÙˆÛŒØ¨ Ø³Ø§Ø¦Ù¹/QR Ù„Ù†Ú©</label>
<input id="qrLink" required="" type="url"/>
</div>
<div class="form-group">
<label>Ù¾ØªÛ (Address)</label>
<textarea id="address" required="" rows="3"></textarea>
</div>
<div class="form-row">
<div class="form-group">
<label>Ù¾Ø±Ø§Ø¦Ù…Ø±ÛŒ Ø±Ù†Ú¯</label>
<input id="primaryColor" type="color" value="#2d5f3f"/>
</div>
<div class="form-group">
<label>Ø³ÛŒÚ©Ù†ÚˆØ±ÛŒ Ø±Ù†Ú¯</label>
<input id="secondaryColor" type="color" value="#f97316"/>
</div>
</div>
<div style="display: flex; gap: 15px; margin-top: 25px;">
<button class="btn btn-success" style="flex: 1;" type="submit">ğŸ’¾ Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
<button class="btn btn-danger" onclick="closeModal()" style="flex: 1;" type="button">âŒ Ù…Ù†Ø³ÙˆØ®
                        Ú©Ø±ÛŒÚº</button>
</div>
</form>
</div>
</div>
<div class="modal" id="previewModal">
<div class="modal-content" style="max-width: 650px;">
<button class="modal-close" onclick="closePreviewModal()">Ã—</button>
<h2 style="margin-bottom: 20px; text-align: center; color: #2d5f3f;">Ù¾ÙˆØ³Ù¹Ø± Ù¾ÛŒØ´ Ù†Ø¸Ø§Ø±Û</h2>
<div class="preview-container" id="previewContainer"></div>
<div style="display: flex; gap: 15px; margin-top: 20px;">
<button class="btn btn-primary" onclick="exportToPNG()" style="flex: 1;">ğŸ–¼ï¸ PNG ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ</button>
<button class="btn btn-info" onclick="exportToPDF()" style="flex: 1;">ğŸ“„ PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ</button>
<button class="btn btn-danger" onclick="closePreviewModal()" style="flex: 1;">Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº</button>
</div>
</div>
</div>
<div class="loading" id="loadingOverlay">
<div class="spinner"></div>
<p style="text-align: center; font-weight: 600; color: #2d5f3f;">Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù†ØªØ¸Ø§Ø± Ú©Ø±ÛŒÚº...</p>
</div>
<script>
        let db;
        let currentPosterId = null;
        let currentPosterData = null;

        const initDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('PosterCreatorDB', 1);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    if (!database.objectStoreNames.contains('posters')) {
                        const objectStore = database.createObjectStore('posters', { keyPath: 'id', autoIncrement: true });
                        objectStore.createIndex('institutionNameUrdu', 'institutionNameUrdu', { unique: false });
                        objectStore.createIndex('createdAt', 'createdAt', { unique: false });
                    }
                };
            });
        };

        const seedInitialData = async () => {
            const transaction = db.transaction(['posters'], 'readonly');
            const objectStore = transaction.objectStore('posters');
            const countRequest = objectStore.count();
            countRequest.onsuccess = async () => {
                if (countRequest.result === 0) {
                    const seedData = [
                        {
                            institutionNameUrdu: 'Ù…Ø¹ÛØ¯ Ø§Ù„Ø±Ø´ÛŒØ¯',
                            institutionNameEng: 'Ma\'had Rasheed',
                            announcement: 'Ø§Ø¹Ù„Ø§Ù† Ø¯Ø§Ø®Ù„Ø§Øª 1446/2025',
                            startDate: '25 Ø¬ÙˆÙ„Ø§Ø¦ÛŒ',
                            endDate: '9 Ø§Ú¯Ø³Øª',
                            features: 'Ø³Ú©Ø§Ù„Ø± Ø´Ù¾ Ú©ÛŒ Ø³ÛÙˆÙ„Øª|Ù‚Ø±Ø¢Ù† Ùˆ Ø­Ø¯ÛŒØ« Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…|Ø¬Ø¯ÛŒØ¯ ØªØ¹Ù„ÛŒÙ…ÛŒ Ù†ØµØ§Ø¨|ØªØ±Ø¨ÛŒØª ÛŒØ§ÙØªÛ Ø§Ø³Ø§ØªØ°Û|Ø§Ø³Ù„Ø§Ù…ÛŒ Ù…Ø§Ø­ÙˆÙ„|Ú©Ù…Ù¾ÛŒÙˆÙ¹Ø± Ù„ÛŒØ¨|Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ Ú©ÛŒ Ø³ÛÙˆÙ„Øª',
                            conditions: 'Ø¯Ø§Ø®Ù„Û’ Ú©ÛŒ Ø¢Ø®Ø±ÛŒ ØªØ§Ø±ÛŒØ®|Ù…ÛŒÙ¹Ø±Ú© ÛŒØ§ Ù…Ø³Ø§ÙˆÛŒ Ø³Ù†Ø¯ Ù„Ø§Ø²Ù…ÛŒ|Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÙØ§Ø±Ù… Ù…Ú©Ù…Ù„ Ø¨Ú¾Ø±ÛŒÚº|Ø¯Ùˆ ØªØµØ§ÙˆÛŒØ± Ù…Ù†Ø³Ù„Ú© Ú©Ø±ÛŒÚº',
                            contactNumbers: '03702770214, 03167677645',
                            qrLink: 'https://mahadrasheed.edu.pk',
                            address: 'Ø§Ù„Ù…Ø§Ø³ Ø±ÙˆÚˆØŒ Ø¨Ø§Ø¨Ù† Ú©Ø§Ú†ÛØŒ ØªØ­ØµÛŒÙ„ Ùˆ Ø¶Ù„Ø¹ Ø¨Ù†ÙˆÚº',
                            primaryColor: '#2d5f3f',
                            secondaryColor: '#f97316',
                            createdAt: Date.now()
                        },
                        {
                            institutionNameUrdu: 'Ø¬Ø§Ù…Ø¹Û Ø§Ø´Ø±ÙÛŒÛ',
                            institutionNameEng: 'Jamia Ashrafia',
                            announcement: 'Ø§Ø¹Ù„Ø§Ù† Ø¯Ø§Ø®Ù„Ø§Øª 2025-2026',
                            startDate: '1 Ø§Ú¯Ø³Øª',
                            endDate: '20 Ø§Ú¯Ø³Øª',
                            features: 'Ù…ÙØª ØªØ¹Ù„ÛŒÙ…|Ø±ÛØ§Ø¦Ø´ Ú©ÛŒ Ø³ÛÙˆÙ„Øª|Ø¯Ø±Ø³Ù Ù†Ø¸Ø§Ù…ÛŒ Ù†ØµØ§Ø¨|Ø¹ØµØ±ÛŒ Ø¹Ù„ÙˆÙ… Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…|Ú©Ú¾ÛŒÙ„ÙˆÚº Ú©ÛŒ Ø³ÛÙˆÙ„ÛŒØ§Øª|Ù…ÛŒÚˆÛŒÚ©Ù„ Ø³ÛŒÙ†Ù¹Ø±|ÚˆÛŒØ¬ÛŒÙ¹Ù„ Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ',
                            conditions: 'Ø¹Ù…Ø± 15 Ø³Ø§Ù„ ÛŒØ§ Ø§Ø³ Ø³Û’ Ø²ÛŒØ§Ø¯Û|Ù…Ø°ÛØ¨ÛŒ ØªØ¹Ù„ÛŒÙ… Ú©ÛŒ Ø¨Ù†ÛŒØ§Ø¯ÛŒ Ø¢Ú¯Ø§ÛÛŒ|ÙˆØ§Ù„Ø¯ÛŒÙ† Ú©ÛŒ ØªØ­Ø±ÛŒØ±ÛŒ Ø§Ø¬Ø§Ø²Øª|Ù…ÛŒÚˆÛŒÚ©Ù„ Ø³Ø±Ù¹ÛŒÙÚ©ÛŒÙ¹ Ø¶Ø±ÙˆØ±ÛŒ',
                            contactNumbers: '03001234567, 03459876543',
                            qrLink: 'https://jamiaashrafia.edu.pk',
                            address: 'Ø´Ø§ÛØ±Ø§ÛÙ Ù‚Ø§Ø¦Ø¯ Ø§Ø¹Ø¸Ù…ØŒ Ù¾Ø´Ø§ÙˆØ±ØŒ Ø®ÛŒØ¨Ø± Ù¾Ø®ØªÙˆÙ†Ø®ÙˆØ§',
                            primaryColor: '#1e4d2b',
                            secondaryColor: '#ea580c',
                            createdAt: Date.now() - 86400000
                        },
                        {
                            institutionNameUrdu: 'Ø¯Ø§Ø±Ø§Ù„Ø¹Ù„ÙˆÙ… Ø­Ù‚Ø§Ù†ÛŒÛ',
                            institutionNameEng: 'Darul Uloom Haqqania',
                            announcement: 'Ù†Ø¦Û’ ØªØ¹Ù„ÛŒÙ…ÛŒ Ø³Ø§Ù„ Ú©Ø§ Ø§Ø¹Ù„Ø§Ù† 1447',
                            startDate: '10 Ø³ØªÙ…Ø¨Ø±',
                            endDate: '30 Ø³ØªÙ…Ø¨Ø±',
                            features: 'Ø­ÙØ¸ Ù‚Ø±Ø¢Ù† Ú©ÛŒ Ø³ÛÙˆÙ„Øª|Ø¹Ù„Ù…Ø§ Ú©ÛŒ ØªÛŒØ§Ø±ÛŒ|Ø¯ÛŒÙ†ÛŒ Ùˆ Ø¹ØµØ±ÛŒ ØªØ¹Ù„ÛŒÙ…|Ù…ÙØª Ú©ØªØ¨|Ù…Ø¬Ø§Ù†ÛŒ Ø·Ø¹Ø§Ù…|ÙˆØ§Ø´Ù†Ú¯ Ø³ÛÙˆÙ„ÛŒØ§Øª|Ø§Ù†Ù¹Ø±Ù†ÛŒÙ¹ Ú©ÛŒ Ø³ÛÙˆÙ„Øª',
                            conditions: 'Ú©Ù… Ø§Ø² Ú©Ù… Ù…ÛŒÙ¹Ø±Ú© Ù¾Ø§Ø³|Ø¹Ù…Ø± 16 Ø³Û’ 25 Ø³Ø§Ù„|Ø§Ù†Ù¹Ø±ÙˆÛŒÙˆ Ù„Ø§Ø²Ù…ÛŒ|Ú¯Ø§Ø±Ù†Ù¹ÛŒ ÙØ§Ø±Ù… Ø¶Ø±ÙˆØ±ÛŒ',
                            contactNumbers: '03125556677, 03335554433',
                            qrLink: 'https://darululoomhaqqania.edu.pk',
                            address: 'Ø§Ú©ÙˆÚ‘Û Ø®Ù¹Ú©ØŒ Ù†ÙˆØ´ÛØ±ÛØŒ Ø®ÛŒØ¨Ø± Ù¾Ø®ØªÙˆÙ†Ø®ÙˆØ§',
                            primaryColor: '#14532d',
                            secondaryColor: '#dc2626',
                            createdAt: Date.now() - 172800000
                        },
                        {
                            institutionNameUrdu: 'Ø¬Ø§Ù…Ø¹Û Ø¹Ù„ÙˆÙ… Ø§Ø³Ù„Ø§Ù…ÛŒÛ',
                            institutionNameEng: 'Jamia Uloom Islamia',
                            announcement: 'Ø¯Ø§Ø®Ù„Û Ú©Ú¾Ù„Ø§ ÛÛ’ - 2025',
                            startDate: '5 Ø¬ÙˆÙ†',
                            endDate: '25 Ø¬ÙˆÙ†',
                            features: 'Ø§Ø¹Ù„ÛŒÙ° ØªØ¹Ù„ÛŒÙ…ÛŒ Ù…Ø¹ÛŒØ§Ø±|ØªØ¬ÙˆÛŒØ¯ Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…|ÙÙ‚Û Ùˆ Ø§ØµÙˆÙ„|Ø¹Ø±Ø¨ÛŒ Ø²Ø¨Ø§Ù† Ú©ÛŒ Ù…ÛØ§Ø±Øª|ØªÙ‚Ø§Ø±ÛŒØ± Ú©ÛŒ ØªØ±Ø¨ÛŒØª|Ø³Ø§Ù„Ø§Ù†Û Ù…Ù‚Ø§Ø¨Ù„Û’|Ø§Ø³Ú©Ø§Ù„Ø±Ø´Ù¾ Ù¾Ø±ÙˆÚ¯Ø±Ø§Ù…',
                            conditions: 'Ø¯Ø§Ø®Ù„Û ÙØ§Ø±Ù… ÙÛŒØ³ 500 Ø±ÙˆÙ¾Û’|Ù…ÛŒÚˆÛŒÚ©Ù„ Ú†ÛŒÚ© Ø§Ù¾ Ù„Ø§Ø²Ù…ÛŒ|Ø³Ø§Ø¨Ù‚Û ØªØ¹Ù„ÛŒÙ…ÛŒ Ø±ÛŒÚ©Ø§Ø±Úˆ|Ú©Ø±Ø¯Ø§Ø± Ø³Ø±Ù¹ÛŒÙÚ©ÛŒÙ¹ Ø¶Ø±ÙˆØ±ÛŒ',
                            contactNumbers: '03217778899, 03448889900',
                            qrLink: 'https://jamiauloomislamia.edu.pk',
                            address: 'Ø¹Ù„Ø§Ù…Û Ø§Ù‚Ø¨Ø§Ù„ Ø±ÙˆÚˆØŒ Ø¨Ù†ÙˆÚºØŒ Ø®ÛŒØ¨Ø± Ù¾Ø®ØªÙˆÙ†Ø®ÙˆØ§',
                            primaryColor: '#15803d',
                            secondaryColor: '#f59e0b',
                            createdAt: Date.now() - 259200000
                        }
                    ];
                    for (const data of seedData) {
                        await addPoster(data);
                    }
                    loadPosters();
                }
            };
        };

        const addPoster = (data) => {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['posters'], 'readwrite');
                const objectStore = transaction.objectStore('posters');
                const request = objectStore.add(data);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        };

        const updatePoster = (id, data) => {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['posters'], 'readwrite');
                const objectStore = transaction.objectStore('posters');
                const request = objectStore.put({ ...data, id });
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        };

        const deletePoster = (id) => {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['posters'], 'readwrite');
                const objectStore = transaction.objectStore('posters');
                const request = objectStore.delete(id);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        };

        const getAllPosters = () => {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['posters'], 'readonly');
                const objectStore = transaction.objectStore('posters');
                const request = objectStore.getAll();
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        };

        const generateQRCode = async (text, size = 120) => {
            const canvas = document.createElement('canvas');
            await QRCode.toCanvas(canvas, text, {
                width: size,
                margin: 1,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            });
            return canvas.toDataURL();
        };

        const createPosterHTML = async (data) => {
            const qrCodeDataURL = await generateQRCode(data.qrLink);
            const features = data.features.split('|');
            const conditions = data.conditions.split('|');
            const contacts = data.contactNumbers.split(',');
            return `
<div class="poster-template" id="poster-${data.id}" style="--primary: ${data.primaryColor}; --secondary: ${data.secondaryColor};">
<div class="poster-header">
<div class="header-logos">
<div class="logo-placeholder" style="background: ${data.primaryColor};">ğŸ•Œ</div>
<div class="logo-placeholder" style="background: ${data.secondaryColor};">ğŸ“š</div>
</div>
<div class="header-title">
<h1>${data.institutionNameUrdu}</h1>
<h2>${data.institutionNameEng}</h2>
</div>
<div style="width: 100px; z-index: 1;"></div>
</div>

<div class="poster-body">
<div class="announcement-box" style="background: linear-gradient(135deg, ${data.primaryColor}, ${adjustColor(data.primaryColor, -30)});">
${data.announcement}
</div>

<div class="images-section">
${Array(6).fill(0).map((_, i) => `<div class="hex-image" style="background: linear-gradient(135deg, ${data.primaryColor}, ${data.secondaryColor});">${['ğŸ“', 'ğŸ“–', 'âœï¸', 'ğŸ¤', 'ğŸ’¡', 'ğŸŒŸ'][i]}</div>`).join('')}
</div>

<div class="content-grid">
<div class="features-section">
<h3 style="background: ${data.primaryColor};">Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ø®ØµÙˆØµÛŒØ§Øª</h3>
${features.map(f => `<div class="feature-item"><span>${f.trim()}</span></div>`).join('')}
</div>

<div class="conditions-section">
<h3 style="background: ${data.secondaryColor};">Ø´Ø±Ø§Ø¦Ø·</h3>
${conditions.map(c => `<div class="feature-item"><span>${c.trim()}</span></div>`).join('')}
</div>
</div>

<div class="date-badges">
<div class="date-badge" style="background: linear-gradient(135deg, ${data.primaryColor}, ${adjustColor(data.primaryColor, -20)});">ğŸ“… ${data.startDate}</div>
<div class="date-badge" style="background: linear-gradient(135deg, ${data.secondaryColor}, ${adjustColor(data.secondaryColor, -20)});">ğŸ—“ï¸ ${data.endDate}</div>
</div>

<div class="qr-contact-section">
<div>
<img src="${qrCodeDataURL}" class="qr-code" alt="QR Code">
<p style="text-align: center; margin-top: 8px; font-size: 12px; font-weight: 600;">Ù…Ø²ÛŒØ¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</p>
</div>
<div class="contact-info">
<div class="contact-item">ğŸ“ Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±Ø²</div>
${contacts.map(c => `<div class="contact-item">${c.trim()}</div>`).join('')}
<div class="contact-item" style="margin-top: 12px;">ğŸ“ ${data.address}</div>
</div>
</div>

<div class="footer-banner" style="background: linear-gradient(135deg, ${data.primaryColor}, ${data.secondaryColor});">
ÙˆØ§Ù„Ø¯ÛŒÙ† Ø§ÙˆØ± Ø·Ù„Ø¨Ø§Ø¡ Ø³Û’ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÛÛ’ Ú©Û Ø¬Ù„Ø¯ Ø§Ø² Ø¬Ù„Ø¯ Ø±Ø¬Ø³Ù¹Ø±ÛŒØ´Ù† Ú©Ø±ÙˆØ§Ø¦ÛŒÚº
</div>
</div>
</div>
`;
        };

        const adjustColor = (color, amount) => {
            const num = parseInt(color.slice(1), 16);
            const r = Math.max(0, Math.min(255, (num >> 16) + amount));
            const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
            const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
            return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, '0')}`;
        };

        const loadPosters = async () => {
            const posters = await getAllPosters();
            const grid = document.getElementById('posterGrid');
            grid.innerHTML = '';
            for (const poster of posters) {
                const posterHTML = await createPosterHTML(poster);
                const card = document.createElement('div');
                card.className = 'poster-card';
                card.innerHTML = `
<div onclick="previewPoster(${poster.id})" style="cursor: pointer;">
${posterHTML}
</div>
<div class="poster-actions">
<button class="btn btn-info" onclick="editPoster(${poster.id})">âœï¸ ØªØ±Ù…ÛŒÙ…</button>
<button class="btn btn-success" onclick="duplicatePoster(${poster.id})">ğŸ“‹ Ù†Ù‚Ù„</button>
<button class="btn btn-danger" onclick="confirmDelete(${poster.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
</div>
`;
                grid.appendChild(card);
            }
        };

        const openCreateModal = () => {
            document.getElementById('posterForm').reset();
            document.getElementById('posterId').value = '';
            document.getElementById('editorModal').classList.add('active');
        };

        const closeModal = () => {
            document.getElementById('editorModal').classList.remove('active');
        };

        const closePreviewModal = () => {
            document.getElementById('previewModal').classList.remove('active');
            currentPosterData = null;
        };

        const editPoster = async (id) => {
            const transaction = db.transaction(['posters'], 'readonly');
            const objectStore = transaction.objectStore('posters');
            const request = objectStore.get(id);
            request.onsuccess = () => {
                const poster = request.result;
                document.getElementById('posterId').value = poster.id;
                document.getElementById('institutionNameUrdu').value = poster.institutionNameUrdu;
                document.getElementById('institutionNameEng').value = poster.institutionNameEng;
                document.getElementById('announcement').value = poster.announcement;
                document.getElementById('startDate').value = poster.startDate;
                document.getElementById('endDate').value = poster.endDate;
                document.getElementById('features').value = poster.features;
                document.getElementById('conditions').value = poster.conditions;
                document.getElementById('contactNumbers').value = poster.contactNumbers;
                document.getElementById('qrLink').value = poster.qrLink;
                document.getElementById('address').value = poster.address;
                document.getElementById('primaryColor').value = poster.primaryColor;
                document.getElementById('secondaryColor').value = poster.secondaryColor;
                document.getElementById('editorModal').classList.add('active');
            };
        };

        const savePoster = async (event) => {
            event.preventDefault();
            const id = document.getElementById('posterId').value;
            const posterData = {
                institutionNameUrdu: document.getElementById('institutionNameUrdu').value,
                institutionNameEng: document.getElementById('institutionNameEng').value,
                announcement: document.getElementById('announcement').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                features: document.getElementById('features').value,
                conditions: document.getElementById('conditions').value,
                contactNumbers: document.getElementById('contactNumbers').value,
                qrLink: document.getElementById('qrLink').value,
                address: document.getElementById('address').value,
                primaryColor: document.getElementById('primaryColor').value,
                secondaryColor: document.getElementById('secondaryColor').value,
                createdAt: id ? undefined : Date.now()
            };
            if (id) {
                await updatePoster(parseInt(id), posterData);
            } else {
                await addPoster(posterData);
            }
            closeModal();
            await loadPosters();
        };

        const confirmDelete = (id) => {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ ÛŒÛ Ù¾ÙˆØ³Ù¹Ø± Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                deletePoster(id).then(() => loadPosters());
            }
        };

        const duplicatePoster = async (id) => {
            const transaction = db.transaction(['posters'], 'readonly');
            const objectStore = transaction.objectStore('posters');
            const request = objectStore.get(id);
            request.onsuccess = async () => {
                const poster = request.result;
                delete poster.id;
                poster.institutionNameUrdu += ' (Ù†Ù‚Ù„)';
                poster.createdAt = Date.now();
                await addPoster(poster);
                await loadPosters();
            };
        };

        const deleteAllPosters = () => {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ØªÙ…Ø§Ù… Ù¾ÙˆØ³Ù¹Ø± Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ ÛŒÛ Ø¹Ù…Ù„ ÙˆØ§Ù¾Ø³ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªØ§Û”')) {
                const transaction = db.transaction(['posters'], 'readwrite');
                const objectStore = transaction.objectStore('posters');
                objectStore.clear();
                transaction.oncomplete = () => loadPosters();
            }
        };

        const previewPoster = async (id) => {
            showLoading();
            const transaction = db.transaction(['posters'], 'readonly');
            const objectStore = transaction.objectStore('posters');
            const request = objectStore.get(id);
            request.onsuccess = async () => {
                currentPosterData = request.result;
                currentPosterId = id;
                const posterHTML = await createPosterHTML(currentPosterData);
                document.getElementById('previewContainer').innerHTML = posterHTML;
                document.getElementById('previewModal').classList.add('active');
                hideLoading();
            };
        };

        const exportToPNG = async () => {
            if (!currentPosterData) return;
            showLoading();
            const posterElement = document.querySelector('#previewContainer .poster-template');
            const canvas = await html2canvas(posterElement, {
                scale: 3,
                useCORS: true,
                backgroundColor: '#ffffff',
                logging: false
            });
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentPosterData.institutionNameEng.replace(/\s+/g, '_')}_poster_${Date.now()}.png`;
                a.click();
                URL.revokeObjectURL(url);
                hideLoading();
            });
        };

        const exportToPDF = async () => {
            if (!currentPosterData) return;
            showLoading();
            const posterElement = document.querySelector('#previewContainer .poster-template');
            const canvas = await html2canvas(posterElement, {
                scale: 3,
                useCORS: true,
                backgroundColor: '#ffffff',
                logging: false
            });
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            const imgWidth = 210;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight, '', 'FAST');
            pdf.save(`${currentPosterData.institutionNameEng.replace(/\s+/g, '_')}_poster_${Date.now()}.pdf`);
            hideLoading();
        };

        const exportAllData = async () => {
            const posters = await getAllPosters();
            const dataStr = JSON.stringify(posters, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `poster_backup_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        };

        const importData = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (!Array.isArray(data)) {
                        alert('ØºÙ„Ø· ÙØ§Ø¦Ù„ ÙØ§Ø±Ù…ÛŒÙ¹');
                        return;
                    }
                    for (const poster of data) {
                        delete poster.id;
                        await addPoster(poster);
                    }
                    await loadPosters();
                    alert('ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¯Ø±Ø¢Ù…Ø¯ ÛÙˆ Ú¯ÛŒØ§');
                } catch (error) {
                    alert('ÙØ§Ø¦Ù„ Ù¾Ú‘Ú¾Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        };

        const showLoading = () => {
            document.getElementById('loadingOverlay').classList.add('active');
        };

        const hideLoading = () => {
            document.getElementById('loadingOverlay').classList.remove('active');
        };

        window.addEventListener('DOMContentLoaded', async () => {
            await initDB();
            await seedInitialData();
            await loadPosters();
        });
    </script>
<script type="module">
  import { Workbox } from 'https://storage.googleapis.com/workbox-cdn/releases/7.0.0/workbox-window.prod.mjs';

  const swUrl = './sw.js';
  const wb = new Workbox(swUrl);

  wb.addEventListener('waiting', () => {
    console.log('A new service worker is waiting to activate.');
    wb.messageSW({ type: 'SKIP_WAITING' });
  });

  wb.addEventListener('controlling', () => {
    console.log('The new service worker is now in control. Reloading page for updates...');
    window.location.reload();
  });

  wb.register();
</script></body>
</html>